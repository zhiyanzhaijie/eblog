import router from"@/router";import store from"@/store";import NProgress from"nprogress";import"nprogress/nprogress.css";const whiteForm=["/login","/404"];router.beforeEach(async(to,from,next)=>{if(NProgress.start(),console.log(0,to.path),whiteForm.includes(to.path))next(),console.log("自家人放行");else{const hasToken=store.getters.Token;if(hasToken){const userId=store.getters.userId,userInfo=store.getters.userInfo,routes=store.getters.routes;if(userInfo.userId&&routes)next(),console.log("东西都够了放行");else{try{await store.dispatch("SET_USERINFO",userId);const asyncRoutes=await store.dispatch("SET_ROUTES");await asyncRoutes.forEach(route=>{router.addRoute("Main",route)})}catch(e){next("/login"),await store.dispatch("USER_LOGOUT")}next()}}else next("/login")}NProgress.done()}),router.afterEach(()=>{NProgress.done()});